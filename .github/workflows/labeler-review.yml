name: "Labels: Approved"
on:
  pull_request_review:
    types: [submitted]
jobs:
  add_label:
    # Change the repository name after you've made sure the team name is correct for your fork!
    if: ${{ (github.repository == 'Sector-Vestige/Sector-Vestige') && (github.event.review.state == 'APPROVED') }}
    permissions:
      contents: read
      pull-requests: write
    runs-on: ubuntu-latest
    steps:
    - uses: tspascoal/get-user-teams-membership@v3
      id: checkUserMember
      with:
        username: ${{ github.actor }}
        team: "admin-team"
        GITHUB_TOKEN: ${{ secrets.WEH_BOT_PAT }}
    - name: Manage labels
      if: ${{ steps.checkUserMember.outputs.isTeamMember == 'true' }}
      uses: actions/github-script@v7
      with:
        script: |
          const issue_number = context.issue.number;
          const owner = context.repo.owner;
          const repo = context.repo.repo;

          // Add "S: Approved" label
          await github.rest.issues.addLabels({
            owner,
            repo,
            issue_number,
            labels: ['S: Approved']
          });

          // Remove other status labels
          const labelsToRemove = ['S: Needs Review', 'S: Awaiting Changes'];
          for (const label of labelsToRemove) {
            try {
              await github.rest.issues.removeLabel({
                owner,
                repo,
                issue_number,
                name: label
              });
            } catch (error) {
              // Ignore errors if label doesn't exist
              if (error.status !== 404) throw error;
            }
          }
